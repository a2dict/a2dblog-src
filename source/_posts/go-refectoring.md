---
title: go重构指南
date: 2019-12-28 13:17:39
tags: 编程
---

我有代码洁癖，想把代码写得简单易懂。所以把我的重构经验写这吧。

<!-- more -->

# 定义

**重构（名词）**： 对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。
**重构（动词）**： 使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。

在过去，很多人使用重构这个词来指代码清理。其实，重构的关键在于**运用大量微小且保持软件行为**的步骤，一步步达成大规模的修改。每个单独的重构要么很小，要么由若干小步骤组合而成。因此，如果有人说他们的代码在重构过程中有几天甚至更长时间不可用，基本上你可以确定，他在做的事情不是重构。


# 原则

## 1 删除无效代码

服务版本升级，过渡阶段留下的代码，升级完成应该删除。
多余的代码不是资产！是负债！！

```go
if version == "v2" {
    // doSomething()
}
```

## 2 构建函数抽象

如果一个函数需要查看源码才知道干了什么，那这个函数抽象是不合理的。

## 3 构建变量抽象

## 4 保持不变性

1. 尽量不修改变量的值
2. 延迟变量定义。只在需要时才定义
3. 尽量不写有副作用(side-effect)的，副作用方法注释标记(eg: with-side-effect)

## 5 职责分离

# 技巧

1. 多重key Map可以使用KeyType


# 工具篇

放弃vim吧，拥抱IDE

1. 提取变量
2. 提取方法
