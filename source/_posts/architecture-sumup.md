---
title: 架构总结篇
tags: 架构
date: 2020-04-23 23:37:35
---


这里总结我对架构的思考。

<!-- more -->

# 引文

## 为什么会有这篇文章

工作中见识过形形色色的软件系统。
有的很「清晰」，一眼就看出系统结构。如果出了问题，凭直觉就可以定位到问题所在，并且很容易在不影响其它功能的前提下把BUG修复；
有的很「混乱」，你常常需要找熟悉系统的人，借助过期系统设计文档，有时甚至需要深入代码泥沼，才能理清功能前后关系。你小心翼翼地改动代码，生怕产生一点副作用。

# 软件架构是什么

## 架构的目的

上面提到的两个场景，开发工作中我们时常遇到。
这里引出了架构的目的：尽可能降低系统迭代、开发、维护、部署的时间与经济成本。

架构的目的是实实在在的，衡量一个架构是好是坏的标准是**可度量的成本**。
而不仅仅是架构美学。当然，一个好的架构，常常显现出某种形式上的美；美是抵御复杂的终极武器。

## 架构师的工作

架构是减法。架构从来不能增加系统特性，而是通过约束，保持系统整洁。
架构是trade-off。为了某种特性，常常需要牺牲其它特性。

架构师的工作包括
1) 寻找系统边界，隔离变化，维护系统整洁性
2) 根据业务场景，在系统特性中做合适的取舍

软件架构与传统架构最大的差别是，软件架构是递归的。
从不同层级看，系统展现出不同的架构，但又相互影响。
架构决策贯穿在整个软件开发过程中。所以软件开发并不清晰区分「架构师」与「工程师」，所有人都需要参与架构决策。


## 不同场景下的架构

按关注的层级，架构可以分为
- 服务架构
- 应用架构
- 组件架构
- 代码架构

尽管层级不同，但思考问题的方法是类似的；即合理划分边界，维护架构整洁性。

### 微服务架构与单体服务（应用）架构的差别

微服务是这几年很流行的SOA方案。
通过服务化拆分，每个服务都可独立部署，通常只允许以网络协议进行服务间通信，可以很好地隔离服务间的影响。

但隔离并不意味着解耦。不合理的服务化拆分，只是把耦合的单体架构迁移到云平台上，架构本质并没有改变。
假设有功能变更需求，之前需要改动好几个耦合「组件」，现在就需要改动几个「微服务」。

软件架构是递归与分形的。无论是微服务还是单体服务，架构的本质没有差别。（除了微服务下通信耗时增加，应尽量缩短服务调用链路，这是SOA架构的特性）
架构师思考问题的方法，解决问题的方式是通用的。
事实上，我坚持一个好的架构，应当具备微服务化拆分和单体化合并的特性。（架构是分形的）


## 架构面对的问题

架构的最大的难点在于「不确定性」。
由于需求和问题的不确定性，我们无法预知系统的最终形态。


## 好架构应该满足的特点

架构应该具有演进能力。因为
1) 需求和问题的不确定性，决定了我们不知道架构最终的形态
2) 就算不存在变更需求（一般标志着着项目走向死亡），项目的成熟度也对架构提出不同的需要

好的架构应该包含以下特性
- 分形架构，可以灵活地服务化拆分、单体化合并
- 接口可以快速调整，以适应新需求或接口重构
- 服务边界支持重新划分与调整

幸好软件开发是一个很灵活工程，我们可以通过控制依赖关系调整架构，获得任何想要的特性。


## 做好架构的心法 —— 延迟决策

设计一个演进式架构，保证架构灵活性，要点在于「延迟决策」。

做架构应该区分架构决策与实现细节，尽量推迟实现细节决策。这样有两个好处
1) 由于软件架构是递归的，细节决策预留给更熟悉具体技术细节的开发者更合适
2) 随着对问题的深入理解，有更多的知识/数据来支撑实现细节决策，容易做出更正确的决策

常见的技术细节包括
- 编程语言（go、java、python..）
- 框架（spring、gin..）
- 数据库（mysql、postgres、mongo..）
- 通信协议（Http、Grpc..）

有时候受限于团队技术栈，只允许使用某项技术；如只允许go+mysql。
优秀的架构师应该在设计时保留更多可选项，必要是推动团队学习新技术栈——团队知识也应该是演进式的。


# 架构之技术之外

做事应该区分「目的」与「手段」。

架构师的工作是做架构、程序员的工作是编程...
这么认为的人，就是混淆了「目的」与「手段」；就好像说，作家的工作是「写字」。

架构师工作的目的是，尽可能低成本地**解决问题**；而架构设计、编程通常是最经济的解决问题方式，所以我们做架构.

## 等等，也许你不应该编程

有时候，我们并不清楚市场的真实需求，所以开发「烟雾弹」测试市场反应，验证产品可行性？
等等，你不应该这么做，有更低成本的方式。

一个H5页面或公众号文章，可能已经足够了。

## 架构与组织
Conway定律表明，组织的沟通方式决定了产品的架构。
反向Conway定律，只有与结构想适合的构架，才能高效协作。

多关注组织结构，有利于发现「架构」；必要时通过软件架构推动组织结构演进。


# 架构实践

## 一个通用的Go服务架构
[TODO]

# 参考

- {% post_link  microservices-architecture-memo %}
- 架构整洁之道
- 架构师修炼之道
- 微服务设计
- 领域驱动设计
- 人件